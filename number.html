<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <title>Stay at Home | 数据统计</title>
    <style>
        body,
        html {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .NumberContainer{
            padding: 10px;
            width: 100%;
            height: 400px;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="showContainer"></div>
    
    <script src='https://cdn.jsdelivr.net/npm/echarts@5.3.1/dist/echarts.min.js'></script>
    <script>
        var jsUrl = "https://sinacloud.net/shanghaifabudata/number.js"
        jsUrl += "?"
        jsUrl += Math.random()
        document.write('<scr' + 'ipt type="text/javascript"  src="' + jsUrl + '"></sc' + 'ript>')
    </script>
    <script>
        var showContainer = document.getElementById('showContainer');
        areaNumbers = number.number
        for (const key in areaNumbers) {
            const element = areaNumbers[key];
            console.log(key, element)
            var div_child = '<div id = "show_' + key + '" class="NumberContainer"></div>'
            showContainer.innerHTML += div_child;
        }
    </script>
    <script>
        function toDateString(date) {
            var dateStr = '' + date
            dateStr = dateStr.slice(0, 4) + '-' + dateStr.slice(4);
            dateStr = dateStr.slice(0, 7) + '-' + dateStr.slice(7);
            var dateObj = new Date(dateStr)
            var y = dateObj.getFullYear()
            var m = dateObj.getMonth() + 1
            var d = dateObj.getDate()
            return y + '-' + m + '-' + d
        }
        var daysStr = []
        number.date.forEach(function (key, value) {
            daysStr[value] = toDateString(key)
        })
        console.log(daysStr)
        for (const key in areaNumbers) {
            const element = areaNumbers[key];
            element.confirmed_risk_rate = []
            element.asymptomatic_risk_rate = []
            for (let index = 0; index < element.confirmed.length; index++) {
                if(element.confirmed[index] > 0){
                    element.confirmed_risk_rate[index] = 100*element.confirmed_risk[index]/element.confirmed[index];
                } else {
                    element.confirmed_risk_rate[index] = 0;
                } 
            }
            for (let index = 0; index < element.asymptomatic.length; index++) {
                if(element.asymptomatic[index] > 0){
                    element.asymptomatic_risk_rate[index] = 100*element.asymptomatic_risk[index]/element.asymptomatic[index];
                } else {
                    element.asymptomatic_risk_rate[index] = 0;
                } 
            }

            var numChartDom = document.getElementById('show_'+key);
            var numChart = echarts.init(numChartDom);
            var numOption = {
                title: {
                    text: key
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                toolbox: {
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                legend: {
                    show: true,
                    type: 'scroll'
                },
                xAxis: [
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                    },
                ],
                yAxis: [
                    {
                        type: 'value',
                        name: '人数'
                    },
                ],
                series: [
                    {
                        name: '确诊+无症状',
                        type: 'line',
                        data: element.total
                    },
                    {
                        name: '确诊',
                        type: 'line',
                        data: element.confirmed
                    },
                    {
                        name: '野生确诊',
                        //yAxisIndex: 1,
                        type: 'line',
                        data: element.confirmed_risk
                    },
                    {
                        name: '无症状',
                        type: 'line',
                        data: element.asymptomatic
                    },
                    {
                        name: '野生无症状',
                        //yAxisIndex: 1,
                        type: 'line',
                        data: element.asymptomatic_risk
                    },
                ]
            };

            numOption && numChart.setOption(numOption);
        }
    </script>
</body>

</html>