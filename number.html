<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <title>Stay at Home | 数据统计</title>
    <style>
        body,
        html {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .GridContainer {
            width: 100%;
            height: 1800px;
            overflow: hidden;
            padding: 20px 5px;
        }

        .TotalContainer {
            width: 100%;
            height: 1200px;
            overflow: hidden;
            padding: 20px 5px;
        }

        .BigContainer {
            width: 100%;
            height: 700px;
            overflow: hidden;
            padding: 20px 5px;
        }

        .NumberContainer {
            width: 100%;
            height: 550px;
            overflow: hidden;
            padding: 20px 5px;
        }
    </style>
</head>

<body>

    <div id="showContainer" style="padding: 10px;">
        <div id="ShanghaiContainer" class="BigContainer"></div>
        <div id="totalContainer" class="BigContainer"></div>
        <div id="riskContainer" class="BigContainer"></div>
    </div>

    <script src='https://cdn.jsdelivr.net/npm/echarts@5.3.1/dist/echarts.min.js'></script>
    <script>
        var jsUrl = "https://sinacloud.net/shanghaifabudata/number.js"
        jsUrl += "?"
        jsUrl += Math.random()
        document.write('<scr' + 'ipt type="text/javascript"  src="' + jsUrl + '"></sc' + 'ript>')
    </script>
    <script>
        console.log('number = ', number)
        var showContainer = document.getElementById('showContainer');
        areaNumbers = number.number
        areaCount = 0
        for (const key in areaNumbers) {
            if (areaCount > 0) {
                const element = areaNumbers[key];
                console.log(key, element)
                var div_child = '<div id = "show_total_' + key + '" class="NumberContainer"></div>'
                showContainer.innerHTML += div_child;
            }
            areaCount++
        }
    </script>
    <script>
        function toDateString(date) {
            var dateStr = '' + date
            dateStr = dateStr.slice(0, 4) + '-' + dateStr.slice(4);
            dateStr = dateStr.slice(0, 7) + '-' + dateStr.slice(7);
            var dateObj = new Date(dateStr)
            var y = dateObj.getFullYear()
            var m = dateObj.getMonth() + 1
            var d = dateObj.getDate()
            return m + '-' + d
        }
        document.title = "Stay at Home | 数据统计(" + toDateString(number.endDate) + ')'
        var daysStr = []
        number.date.forEach(function (key, value) {
            daysStr[value] = toDateString(key)
        })
        console.log(daysStr)

        function ShowTotalGrid() {
            var dom = document.getElementById('totalGridContainer');
            var chart = echarts.init(dom);
            console.log(dom, chart)
            var N_POINT = 30;
            var grids = [];
            var xAxes = [];
            var yAxes = [];
            var series = [];
            var titles = [];
            var count = 0;
            Object.keys(areaNumbers).forEach(function (key) {
                element = areaNumbers[key]
                console.log('ShowTotalGrid', key, element)

                grids.push({
                    show: true,
                    borderWidth: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.3)',
                    shadowBlur: 2
                });

                xAxes.push({
                    type: 'category',
                    show: true,
                    axisTick: {
                        show: false
                    },
                    name: '日期',
                    data: daysStr,
                    gridIndex: count
                });

                yAxes.push({
                    type: 'value',
                    show: true,
                    gridIndex: count,
                    splitNumber: 1,
                    interval: 'max'
                });
                series.push({
                    name: key,
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    xAxisIndex: count,
                    yAxisIndex: count,
                    data: element.total
                });
                titles.push({
                    textAlign: 'center',
                    text: key,
                    textStyle: {
                        fontSize: 12,
                        fontWeight: 'normal'
                    }
                });
                count++;
            })
            grid_num = count + 1
            grids.forEach(function (grid, idx) {
                console.log('grids', grid, idx)
                grid.top = 10 + idx * 100;
                grid.left = 80
                grid.right = 50
                grid.height = 60;
                console.log('grids', grid, idx)
                titles[idx].left = 15
                titles[idx].top = grid.top + 20
                console.log('titles', titles, idx)
            });
            option = {
                title: titles.concat([
                    {
                        text: '确诊+无症状',
                        top: 'bottom',
                        left: 'center'
                    }
                ]),
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                grid: grids,
                xAxis: xAxes,
                yAxis: yAxes,
                series: series
            };

            option && chart.setOption(option);
        }
        //ShowTotalGrid()

        allTotal = []
        allRisk = []
        shanghaiObj = null
        areaIndex = 0


        for (const key in areaNumbers) {
            const element = areaNumbers[key];
            element.confirmed_risk_rate = []
            element.asymptomatic_risk_rate = []
            for (let index = 0; index < element.confirmed.length; index++) {
                if (element.confirmed[index] > 0) {
                    element.confirmed_risk_rate[index] = 100 * element.confirmed_risk[index] / element.confirmed[index];
                } else {
                    element.confirmed_risk_rate[index] = 0;
                }
            }
            for (let index = 0; index < element.asymptomatic.length; index++) {
                if (element.asymptomatic[index] > 0) {
                    element.asymptomatic_risk_rate[index] = 100 * element.asymptomatic_risk[index] / element.asymptomatic[index];
                } else {
                    element.asymptomatic_risk_rate[index] = 0;
                }
            }
            riskData = []
            for (let index = 0; index < element.confirmed_risk.length; index++) {
                riskData[index] = element.confirmed_risk[index] + element.asymptomatic_risk[index];
            }
            element.riskData = riskData

            var riskObj = {
                name: key,
                type: 'line',
                endLabel: {
                    show: true,
                    color: 'inherit'
                },
                data: element.riskData
            }

            allRisk.push(riskObj)

            var totalObj = {
                name: key,
                type: 'line',
                endLabel: {
                    show: true,
                    color: 'inherit'
                },
                data: element.total
            }

            allTotal.push(totalObj)

            areaIndex++

            if (1 == areaIndex) {
                shanghaiObj = element
                continue
            }

            var numChartDom = document.getElementById('show_total_' + key);
            var numChart = echarts.init(numChartDom);

            var series = [
                {
                    name: '总数',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.total
                },
                {
                    name: '确诊',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.confirmed
                },
                {
                    name: '无症状',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.asymptomatic
                },
                {
                    name: '社会面',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.riskData
                },
                {
                    name: '野生确诊',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.confirmed_risk
                },
                {
                    name: '野生无症状',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: element.asymptomatic_risk
                }
            ]
            var grids = [
                {
                    left: 45,
                    right: 45,
                    top: 100,
                    height: '35%'
                },
                {
                    left: 45,
                    right: 45,
                    top: '60%',
                    height: '35%'
                }
            ]

            var numOption = {
                title: {
                    text: key
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                axisPointer: {
                    link: { xAxisIndex: 'all' },
                },
                grid: grids,
                toolbox: {
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                legend: {
                    show: true,
                    top: 30,
                    padding: [
                        5,  // 上
                        30, // 右
                        5,  // 下
                        60, // 左
                    ],
                },
                xAxis: [
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                        gridIndex: 0
                    },
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                        gridIndex: 1
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        gridIndex: 0
                    },
                    {
                        type: 'value',
                        gridIndex: 1
                    }
                ],
                series: series
            };

            numOption && numChart.setOption(numOption);

        }
        // show Shanghai
        {
            var numChartDom = document.getElementById('ShanghaiContainer');
            var numChart = echarts.init(numChartDom);

            var series = [
                {
                    name: '总数',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.total
                },
                {
                    name: '确诊',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.confirmed
                },
                {
                    name: '无症状',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.asymptomatic
                },
                {
                    name: '出舱',
                    type: 'line',
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.discharged
                },
                {
                    name: '社会面',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.riskData
                },
                {
                    name: '野生确诊',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.confirmed_risk
                },
                {
                    name: '野生无症状',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.asymptomatic_risk
                },
                {
                    name: '死亡',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.dead
                },
                {
                    name: '重症',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.severe_patient
                },
                {
                    name: '危重症',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.critical_patient
                },
                {
                    name: '累计死亡',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    endLabel: {
                        show: true,
                        color: 'inherit'
                    },
                    data: shanghaiObj.total_dead
                },
            ]
            var grids = [
                {
                    left: 45,
                    right: 45,
                    top: 100,
                    height: 150
                },
                {
                    left: 45,
                    right: 45,
                    top: 300,
                    height: 150
                }
                ,
                {
                    left: 45,
                    right: 45,
                    top: 500,
                    height: 150
                }
            ]
            var numOption = {
                title: {
                    text: '上海市'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    },
                    position: {
                        top: 180,
                        left: 50,
                    }
                },
                axisPointer: {
                    link: { xAxisIndex: 'all' },
                },
                grid: grids,
                toolbox: {
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                legend: {
                    show: true,
                    top: 25,
                    padding: [
                        5,  // 上
                        30, // 右
                        5,  // 下
                        60, // 左
                    ],
                },
                xAxis: [
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                        gridIndex: 0
                    },
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                        gridIndex: 1
                    },
                    {
                        type: 'category',
                        name: '日期',
                        data: daysStr,
                        gridIndex: 2
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        gridIndex: 0
                    },
                    {
                        type: 'value',
                        gridIndex: 1
                    },
                    {
                        type: 'value',
                        gridIndex: 2
                    }
                ],
                series: series
            };

            numOption && numChart.setOption(numOption);
        }
        console.log(allRisk)

        var riskChartDom = document.getElementById('riskContainer');
        var riskChart = echarts.init(riskChartDom);
        var riskOption = {
            title: {
                text: '社会面'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    crossStyle: {
                        color: '#999'
                    }
                },
                position: {
                    top: 180,
                    left: 50,
                }
            },
            grid: {
                left: 45,
                right: 45,
                top: 150,
            },
            toolbox: {
                feature: {
                    saveAsImage: { show: true }
                }
            },
            legend: {
                show: true,
                top: 30,
                padding: [
                    5,  // 上
                    30, // 右
                    5,  // 下
                    60, // 左
                ],
            },
            xAxis: [
                {
                    type: 'category',
                    name: '日期',
                    data: daysStr,
                }
            ],
            yAxis: [
                {
                    type: 'value',
                }
            ],
            series: allRisk
        };
        riskOption && riskChart.setOption(riskOption);

        var totalChartDom = document.getElementById('totalContainer');
        var totalChart = echarts.init(totalChartDom);
        var totalOption = {
            title: {
                text: '确诊+无症状'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    crossStyle: {
                        color: '#999'
                    }
                },
                position: {
                    top: 180,
                    left: 50,
                }
            },
            grid: {
                left: 45,
                right: 45,
                top: 150,
            },
            toolbox: {
                feature: {
                    saveAsImage: { show: true }
                }
            },
            legend: {
                show: true,
                top: 30,
                padding: [
                    5,  // 上
                    30, // 右
                    5,  // 下
                    60, // 左
                ],
            },
            xAxis: [
                {
                    type: 'category',
                    name: '日期',
                    data: daysStr,
                }
            ],
            yAxis: [
                {
                    type: 'value',
                }
            ],
            series: allTotal
        };
        totalOption && totalChart.setOption(totalOption);
    </script>
</body>

</html>